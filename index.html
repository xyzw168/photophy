<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úß Y2K ULTRA BOOTH ‚úß</title>
    <style>
        :root {
            --pink: #ffafcc; --blue: #a2d2ff; --green: #caffbf; --yellow: #fdffb6;
        }

        body {
            background: var(--blue);
            background-image: radial-gradient(var(--pink) 2px, transparent 2px);
            background-size: 30px 30px;
            font-family: 'Courier New', Courier, monospace;
            display: flex; flex-direction: column; align-items: center; padding: 20px;
        }

        /* Flash & Countdown */
        #flash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; opacity: 0; pointer-events: none; z-index: 999;
        }
        .flash-active { animation: flash-anim 0.3s ease-out; }
        @keyframes flash-anim { 0% { opacity: 1; } 100% { opacity: 0; } }

        #countdown {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 80px; color: var(--pink); font-weight: bold; z-index: 100;
            text-shadow: 4px 4px 0px #000; display: none;
        }

        .window {
            background: #fff; border: 4px solid #000; box-shadow: 12px 12px 0px #000;
            width: 100%; max-width: 550px; overflow: hidden;
        }

        .title-bar {
            background: linear-gradient(90deg, #ff00ff, #00ffff);
            color: white; padding: 8px; font-weight: bold; border-bottom: 4px solid #000;
            display: flex; justify-content: space-between;
        }

        .cam-container {
            position: relative; width: 100%; aspect-ratio: 4/3; background: #222;
        }

        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }

        /* Ini Frame yang muncul di layar */
        .frame-img {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; object-fit: fill; z-index: 20;
        }

        .ui-panel { padding: 20px; text-align: center; }

        /* Tombol Ganti Frame */
        .frame-list {
            display: flex; gap: 10px; justify-content: center; margin-bottom: 15px;
        }
        .frame-thumb {
            width: 50px; height: 50px; border: 2px solid #000; cursor: pointer;
            background: #eee; object-fit: cover;
        }
        .frame-thumb.active { border-color: var(--pink); outline: 3px solid var(--yellow); }

        .btn-capture {
            width: 100%; padding: 15px; font-size: 20px; font-weight: bold;
            background: var(--green); border: 4px solid #000; cursor: pointer;
            box-shadow: 6px 6px 0px #000; margin-bottom: 10px;
        }
        .btn-capture:active { transform: translate(3px, 3px); box-shadow: 3px 3px 0px #000; }

        /* Gallery */
        #gallery {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 30px; width: 100%; max-width: 550px;
        }
        .polaroid {
            background: #fff; padding: 10px; border: 2px solid #000; box-shadow: 5px 5px 0px rgba(0,0,0,0.2);
            display: flex; flex-direction: column;
        }
        .polaroid img { width: 100%; }
        .pol-actions { display: flex; gap: 5px; margin-top: 10px; }
        .pol-actions button { flex: 1; padding: 5px; cursor: pointer; border: 2px solid #000; font-weight: bold; font-size: 10px; }
    </style>
</head>
<body>

<div id="flash"></div>
<div class="window">
    <div class="title-bar">
        <span>üì∏ Y2K_PRO_CAM.EXE</span>
        <span>üìÅ ‚öô ‚òí</span>
    </div>

    <div class="cam-container">
        <div id="countdown">3</div>
        <video id="video" autoplay playsinline></video>
        <img id="frame-preview" class="frame-img" src="https://i.ibb.co/Vvz8r7P/frame1.png">
    </div>

    <div class="ui-panel">
        <div class="frame-list">
            <img class="frame-thumb active" src="https://i.ibb.co/Vvz8r7P/frame1.png" onclick="changeFrame(this)">
            <img class="frame-thumb" src="https://i.ibb.co/L5fX0X3/frame2.png" onclick="changeFrame(this)">
            <img class="frame-thumb" src="https://i.ibb.co/fF3P7tX/frame3.png" onclick="changeFrame(this)">
        </div>

        <button class="btn-capture" id="capture-btn">‚ú® TAKE PHOTO (3s) ‚ú®</button>
    </div>
</div>

<div id="gallery"></div>

<canvas id="canvas" width="800" height="600" style="display:none;"></canvas>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const framePreview = document.getElementById('frame-preview');
    const captureBtn = document.getElementById('capture-btn');
    const countdownEl = document.getElementById('countdown');
    const flash = document.getElementById('flash');
    const gallery = document.getElementById('gallery');

    // 1. Setup Kamera
    navigator.mediaDevices.getUserMedia({ video: { width: 800, height: 600 } })
        .then(stream => video.srcObject = stream);

    // 2. Ganti Frame
    function changeFrame(el) {
        document.querySelectorAll('.frame-thumb').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        framePreview.src = el.src;
    }

    // 3. Logika Capture dengan Countdown
    captureBtn.addEventListener('click', () => {
        let count = 3;
        countdownEl.style.display = 'block';
        countdownEl.innerText = count;
        captureBtn.disabled = true;

        const timer = setInterval(() => {
            count--;
            if (count <= 0) {
                clearInterval(timer);
                countdownEl.style.display = 'none';
                takeSnap();
                captureBtn.disabled = false;
            } else {
                countdownEl.innerText = count;
            }
        }, 1000);
    });

    function takeSnap() {
        // Efek Flash
        flash.classList.add('flash-active');
        setTimeout(() => flash.classList.remove('flash-active'), 300);

        const ctx = canvas.getContext('2d');
        
        // Gambar Video (Mirrored)
        ctx.save();
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        ctx.restore();

        // Gambar Frame (Ambil dari src frame yang aktif)
        const frameImg = new Image();
        frameImg.crossOrigin = "anonymous"; // Biar ga error saat save
        frameImg.src = framePreview.src;
        
        frameImg.onload = () => {
            ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);
            
            // Masukkan ke gallery
            const dataUrl = canvas.toDataURL('image/png');
            addToGallery(dataUrl);
        };
    }

    function addToGallery(dataUrl) {
        const item = document.createElement('div');
        item.className = 'polaroid';
        item.innerHTML = `
            <img src="${dataUrl}">
            <div class="pol-actions">
                <button style="background:var(--yellow)" onclick="downloadImg('${dataUrl}')">DOWNLOAD</button>
                <button style="background:var(--pink)" onclick="this.parentElement.parentElement.remove()">DELETE</button>
            </div>
        `;
        gallery.prepend(item);
    }

    function downloadImg(url) {
        const link = document.createElement('a');
        link.href = url;
        link.download = `y2k_snap_${Date.now()}.png`;
        link.click();
    }
</script>

</body>
</html>
